#!/usr/bin/env bash
# SITE_NAME
# SITE_TITLE
# NODE_VER
# isProduction

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
nvm use $NODE_VER >/dev/null 2>&1

export currentDirectory=$(pwd)
if [ -f .ddev/.plugin-dev-mode ]; then
    export PLUGIN_DEV_MODE=1
fi
buildTargets=()
while IFS= read -r dir; do
    if [ -f "$dir/package.json" ]; then
        if [ -n "$PLUGIN_DEV_MODE" ]; then ## if we are in plugin dev mode, include all
            buildTargets+=("$dir")
        elif [ -f "$dir/style.css" ] && grep -q 'sitchco-parent-theme' "$dir/style.css"; then ## If not plugin dev mode, only include targets where the style.css contains the string 'sitchco-parent-theme'
            buildTargets+=("$dir")
        fi
    fi
done < <(find . -type f -name "sitchco.config.php" -exec dirname {} \; | sort)

export buildTargets
