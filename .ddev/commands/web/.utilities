#!/usr/bin/env bash
# SITE_NAME
# SITE_TITLE
# NODE_VER
# isProduction

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
nvm use $NODE_VER >/dev/null 2>&1

export currentDirectory=$(pwd)
if [ -f .ddev/.plugin-dev-mode ]; then
    export PLUGIN_DEV_MODE=1
fi
buildTargets=()
while IFS= read -r dir; do
    if [ -f "$dir/package.json" ]; then
        ## Only add target if package.json exists. This assumes our dist bundles will remove package.json and include dist build
        buildTargets+=("$dir")
    fi
done < <(find . -type f -name "sitchco.config.php" -exec dirname {} \; | sort)

export buildTargets
